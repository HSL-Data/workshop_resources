<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Data Preparation with DPLYR</title>
    <meta charset="utf-8" />
    <script src="libs/header-attrs-2.19/header-attrs.js"></script>
    <link href="libs/xaringanExtra-extra-styles-0.2.6/xaringanExtra-extra-styles.css" rel="stylesheet" />
    <link href="libs/tachyons-4.12.0/tachyons.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="xaringan-themer_2.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: left, middle, inverse, title-slide

.title[
# Data Preparation with DPLYR
]

---







# Data Preparation

# Packages for Today
Today we are going to be mainly using the dplyr package and the readr package. Since they are both contained within the tidyverse package, we will just load the tidyverse package.


```r
#Run install.packages if you have never installed the tidyverse on your machine.
#install.packages("tidyverse") 
library(tidyverse)

# OR JUST 

library(dplyr)
library(readr)
library(stringr)
library(tidyr)
```

Read in the bigfoot sightings data. We are going to be using the `read_csv()` package today, which will read in the data with some added functionality above `read.csv()`.


```r
bigfoot &lt;- read_csv('bigfoot.csv')

# OR 
# bigfoot &lt;- read.csv('bigfoot.csv')
# bigfoot &lt;- tibble(bigfoot)
```
---
## dplyr

dplyr is a package in R that allows you to work with and manipulate your data. It will allow us to focus in on the variables (columns) of interest and the observations (rows) of interest. 
---
## The Pipe

The pipe is an operator in R that allows you to chain together functions in dplyr. In the past, to use multiple functions you would have to nest your functions inside of each other, but using the pipe allows you to chain the functions together in a readable/reproducible format. The pipe character is `%&gt;%` and essentially means "then" You can create the character using `CTRL+SHIFT+M` or `CMD+SHIFT+M` 

The pipe essentially takes whatever is before the pipe as input for whatever is after the pipe. 


```r
# Normal way to view your dataset
View(bigfoot)

# Using the pipe, the bigfoot dataframe is passed on to the View function
bigfoot %&gt;% 
  View()
```
---
## Head Function 

```r
# The head function looks at the top of the dataframe
head(bigfoot)
```

```
## # A tibble: 6 × 11
##   title   state date       season preci…¹ number tempe…² dew_p…³ humid…⁴ visib…⁵
##   &lt;chr&gt;   &lt;chr&gt; &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 &lt;NA&gt;    Alab… NA         Summer &lt;NA&gt;     30680    NA      NA     NA      NA   
## 2 &lt;NA&gt;    Alas… NA         Fall   &lt;NA&gt;      1261    NA      NA     NA      NA   
## 3 Report… Rhod… 1974-09-20 Fall   &lt;NA&gt;      6496    73.4    65.7    0.86    2.75
## 4 &lt;NA&gt;    Penn… NA         Summer &lt;NA&gt;      8000    NA      NA     NA      NA   
## 5 &lt;NA&gt;    Oreg… NA         Spring &lt;NA&gt;       703    NA      NA     NA      NA   
## 6 Report… Okla… 1973-09-28 Fall   rain      9765    61.4    51.0    0.79   10   
## # … with 1 more variable: uv_index &lt;dbl&gt;, and abbreviated variable names
## #   ¹​precip_type, ²​temperature, ³​dew_point, ⁴​humidity, ⁵​visibility
```

```r
# When you have a function with multiple arguments, the first argument will
# be taken from whatever is before the pipe operator.
head(bigfoot, 3)
```

```
## # A tibble: 3 × 11
##   title   state date       season preci…¹ number tempe…² dew_p…³ humid…⁴ visib…⁵
##   &lt;chr&gt;   &lt;chr&gt; &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 &lt;NA&gt;    Alab… NA         Summer &lt;NA&gt;     30680    NA      NA     NA      NA   
## 2 &lt;NA&gt;    Alas… NA         Fall   &lt;NA&gt;      1261    NA      NA     NA      NA   
## 3 Report… Rhod… 1974-09-20 Fall   &lt;NA&gt;      6496    73.4    65.7    0.86    2.75
## # … with 1 more variable: uv_index &lt;dbl&gt;, and abbreviated variable names
## #   ¹​precip_type, ²​temperature, ³​dew_point, ⁴​humidity, ⁵​visibility
```

---

```r
bigfoot %&gt;% 
  head(3)
```

```
## # A tibble: 3 × 11
##   title   state date       season preci…¹ number tempe…² dew_p…³ humid…⁴ visib…⁵
##   &lt;chr&gt;   &lt;chr&gt; &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 &lt;NA&gt;    Alab… NA         Summer &lt;NA&gt;     30680    NA      NA     NA      NA   
## 2 &lt;NA&gt;    Alas… NA         Fall   &lt;NA&gt;      1261    NA      NA     NA      NA   
## 3 Report… Rhod… 1974-09-20 Fall   &lt;NA&gt;      6496    73.4    65.7    0.86    2.75
## # … with 1 more variable: uv_index &lt;dbl&gt;, and abbreviated variable names
## #   ¹​precip_type, ²​temperature, ³​dew_point, ⁴​humidity, ⁵​visibility
```

```r
bigfoot %&gt;% 
  head(5) %&gt;% 
  tail(1)
```

```
## # A tibble: 1 × 11
##   title state  date   season precip_type number temper…¹ dew_p…² humid…³ visib…⁴
##   &lt;chr&gt; &lt;chr&gt;  &lt;date&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 &lt;NA&gt;  Oregon NA     Spring &lt;NA&gt;           703       NA      NA      NA      NA
## # … with 1 more variable: uv_index &lt;dbl&gt;, and abbreviated variable names
## #   ¹​temperature, ²​dew_point, ³​humidity, ⁴​visibility
```
---


```r
# The pipe is useful for cases like this, where you have three nested functions
head(tail(head(bigfoot, 36), 15), 3)
```

```
## # A tibble: 3 × 11
##   title   state date       season preci…¹ number tempe…² dew_p…³ humid…⁴ visib…⁵
##   &lt;chr&gt;   &lt;chr&gt; &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 Report… New … 2015-10-02 Summer rain     49883    46.7    44.4    0.87    9.16
## 2 Report… New … 2000-05-17 Spring rain      4904    34.9    12.2    0.29   10   
## 3 Report… New … 2006-10-02 Fall   &lt;NA&gt;     16207    55.6    25.8    0.35   10   
## # … with 1 more variable: uv_index &lt;dbl&gt;, and abbreviated variable names
## #   ¹​precip_type, ²​temperature, ³​dew_point, ⁴​humidity, ⁵​visibility
```

```r
bigfoot %&gt;% 
  head(36) %&gt;% 
  tail(15) %&gt;% 
  head(3)
```

```
## # A tibble: 3 × 11
##   title   state date       season preci…¹ number tempe…² dew_p…³ humid…⁴ visib…⁵
##   &lt;chr&gt;   &lt;chr&gt; &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 Report… New … 2015-10-02 Summer rain     49883    46.7    44.4    0.87    9.16
## 2 Report… New … 2000-05-17 Spring rain      4904    34.9    12.2    0.29   10   
## 3 Report… New … 2006-10-02 Fall   &lt;NA&gt;     16207    55.6    25.8    0.35   10   
## # … with 1 more variable: uv_index &lt;dbl&gt;, and abbreviated variable names
## #   ¹​precip_type, ²​temperature, ³​dew_point, ⁴​humidity, ⁵​visibility
```

---
## distinct/count

The distinct function will provide for you the distinct values of a column, while count provides you with both the distinct values of a column and then number of times each value shows up. The following example investigates the different seasons (`season`) in the `bigfoot` dataframe:


```r
bigfoot %&gt;% 
  distinct(season)
```

```
## # A tibble: 5 × 1
##   season 
##   &lt;chr&gt;  
## 1 Summer 
## 2 Fall   
## 3 Spring 
## 4 Winter 
## 5 Unknown
```

```r
#Pipe into nrow() to get the number of distinct seasons (other functions also exist to do something similar)
bigfoot %&gt;% 
  distinct(season) %&gt;% 
  nrow()
```

```
## [1] 5
```
---
### Count


```r
bigfoot %&gt;% 
  count(season)
```

```
## # A tibble: 5 × 2
##   season      n
##   &lt;chr&gt;   &lt;int&gt;
## 1 Fall     1492
## 2 Spring    825
## 3 Summer   1867
## 4 Unknown    92
## 5 Winter    745
```

```r
bigfoot %&gt;% 
  count(precip_type)
```

```
## # A tibble: 3 × 2
##   precip_type     n
##   &lt;chr&gt;       &lt;int&gt;
## 1 rain         1562
## 2 snow          161
## 3 &lt;NA&gt;         3298
```
---
## Exercise 
Using the `bigfoot` dataframe: 

1. Using the pipe, get the summary of the dataframe
2. How many distinct types of uv_index values are in the `bigfoot` dataset? 
3. How many times does `California` come up?


```r
#1.
bigfoot %&gt;% 
  summary()

#2.
bigfoot %&gt;% 
  distinct(uv_index) %&gt;% 
  nrow()
  #15

#3. 
bigfoot %&gt;% 
  count(state)
  #417
```
---
-------------------------

## Arrange

The `arrange()` function does what it sounds like. It takes a data frame or tbl and arranges (or sorts) by column(s) of interest. The first argument is the data, and subsequent arguments are columns to sort on. Use the `desc()` function to arrange by descending.

The following code would get the number of times each state shows up in the bigfoot dataset:


```r
bigfoot %&gt;% 
  count(state) %&gt;% 
  arrange(n)
```

```
## # A tibble: 49 × 2
##    state             n
##    &lt;chr&gt;         &lt;int&gt;
##  1 North Dakota      4
##  2 Delaware          5
##  3 Rhode Island      5
##  4 Nevada            7
##  5 Vermont          10
##  6 South Dakota     13
##  7 New Hampshire    14
##  8 Nebraska         15
##  9 Maine            17
## 10 Connecticut      18
## # … with 39 more rows
```
---

```r
# Since the default is ascending order, we are not getting the results that are probably useful, so let's use the desc() function
bigfoot %&gt;% 
  count(state) %&gt;% 
  arrange(desc(n)) %&gt;% 
  head(3)
```

```
## # A tibble: 3 × 2
##   state          n
##   &lt;chr&gt;      &lt;int&gt;
## 1 Washington   601
## 2 California   417
## 3 Ohio         303
```


```r
# Alternatively you can use the "-" to denote descending
bigfoot %&gt;% 
  arrange(-temperature)
```
---
## filter

If you want to filter **rows** of the data where some condition is true, use the `filter()` function. 

1. The first argument is the data frame you want to filter, e.g. `filter(mydata, ...`.
2. The second argument is a condition you must satisfy, e.g. `filter(clean, variable == "levelA")`.

- `==`: Equal to
- `!=`: Not equal to
- `&gt;`, `&gt;=`: Greater than, greater than or equal to
- `&lt;`, `&lt;=`: Less than, less than or equal to

If you want to satisfy *all* of multiple conditions, you can use the "and" operator, `&amp;`. 

The "or" operator `|` (the pipe character, usually shift-backslash) will return a subset that meet *any* of the conditions.


```r
#Keeps those bigfoot sightings that occurred at over 88 degrees

bigfoot %&gt;% 
  filter(temperature &gt; 88) %&gt;% 
  head(5)
```

```
## # A tibble: 5 × 11
##   title   state date       season preci…¹ number tempe…² dew_p…³ humid…⁴ visib…⁵
##   &lt;chr&gt;   &lt;chr&gt; &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 Report… Miss… 1981-08-15 Summer &lt;NA&gt;     13347    88.1    69.9    0.66    5.45
## 2 Report… Texas 2017-06-23 Summer &lt;NA&gt;     57760    89.4    73.1    0.64    9.82
## 3 Report… Texas 2006-08-01 Summer &lt;NA&gt;     16499    88.4    64.1    0.48   10   
## 4 Report… Texas 2007-08-13 Summer &lt;NA&gt;     21438    88.5    71.2    0.63    8.86
## 5 Report… Texas 2011-06-30 Summer &lt;NA&gt;     30238    88.1    64.8    0.47   10   
## # … with 1 more variable: uv_index &lt;dbl&gt;, and abbreviated variable names
## #   ¹​precip_type, ²​temperature, ³​dew_point, ⁴​humidity, ⁵​visibility
```
---

```r
#Keeps those bigfoot sightings occurred at less than or equal to 20 degrees
bigfoot %&gt;% 
  filter(temperature &lt;= 20) %&gt;% 
  head(5)
```

```
## # A tibble: 5 × 11
##   title   state date       season preci…¹ number tempe…² dew_p…³ humid…⁴ visib…⁵
##   &lt;chr&gt;   &lt;chr&gt; &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 Report… Nort… 1988-03-15 Spring &lt;NA&gt;      3339   17.7     9.5     0.79    9.5 
## 2 Report… Mont… 1988-12-15 Winter snow      1757    7.44    0.16    0.75   10   
## 3 Report… Mont… 2019-03-09 Winter &lt;NA&gt;     63148    9.61    6.41    0.76    9.78
## 4 Report… Mont… 2015-11-26 Summer snow     50297   12.9     1.46    0.65   10   
## 5 Report… Nebr… 2005-01-06 Summer snow      7809    8.60    1.68    0.82    8.21
## # … with 1 more variable: uv_index &lt;dbl&gt;, and abbreviated variable names
## #   ¹​precip_type, ²​temperature, ³​dew_point, ⁴​humidity, ⁵​visibility
```

```r
#Keeps those bigfoot sightings that have a temperature greater than 80 in California
bigfoot %&gt;% 
  filter(temperature &gt; 80 &amp; state == "California") %&gt;% 
  head(5)
```

```
## # A tibble: 4 × 11
##   title   state date       season preci…¹ number tempe…² dew_p…³ humid…⁴ visib…⁵
##   &lt;chr&gt;   &lt;chr&gt; &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 Report… Cali… 1977-08-01 Spring rain      7555    89.2    44.4    0.26    8.67
## 2 Report… Cali… 1997-07-15 Summer rain     11496    80.2    54.0    0.44   10   
## 3 Report… Cali… 2014-07-15 Summer &lt;NA&gt;     59668    82.2    50.0    0.32   10   
## 4 Report… Cali… 2008-07-08 Summer &lt;NA&gt;     24146    82.2    50.1    0.42    7.03
## # … with 1 more variable: uv_index &lt;dbl&gt;, and abbreviated variable names
## #   ¹​precip_type, ²​temperature, ³​dew_point, ⁴​humidity, ⁵​visibility
```
---

```r
#Count the number of bigfoot sightings fitting the conditions above
bigfoot %&gt;% 
  filter(temperature &gt; 80 &amp; state == "California") %&gt;% 
  count() %&gt;% 
  head(5)
```

```
## # A tibble: 1 × 1
##       n
##   &lt;int&gt;
## 1     4
```

```r
#Keeps state that contain a capital I
bigfoot %&gt;% 
  filter(str_detect(state, "I")) %&gt;% 
  head(5)
```

```
## # A tibble: 5 × 11
##   title   state date       season preci…¹ number tempe…² dew_p…³ humid…⁴ visib…⁵
##   &lt;chr&gt;   &lt;chr&gt; &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 Report… Rhod… 1974-09-20 Fall   &lt;NA&gt;      6496    73.4    65.7    0.86    2.75
## 2 Report… Rhod… 1978-07-15 Summer rain      6643    65.8    62.3    0.88    5.71
## 3 Report… Rhod… 2006-11-03 Fall   &lt;NA&gt;     16746    39.8    25.2    0.57   10   
## 4 Report… Rhod… 1998-10-15 Fall   &lt;NA&gt;     15923    51.3    44.7    0.79    9.19
## 5 Report… Rhod… 2011-11-15 Spring &lt;NA&gt;     30906    58.1    51.9    0.79    9.97
## # … with 1 more variable: uv_index &lt;dbl&gt;, and abbreviated variable names
## #   ¹​precip_type, ²​temperature, ³​dew_point, ⁴​humidity, ⁵​visibility
```
---

```r
# The filter function is helpful for dropping missing values
bigfoot %&gt;% 
  filter(!is.na(precip_type)) %&gt;% 
  head(5)
```

```
## # A tibble: 5 × 11
##   title   state date       season preci…¹ number tempe…² dew_p…³ humid…⁴ visib…⁵
##   &lt;chr&gt;   &lt;chr&gt; &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 Report… Okla… 1973-09-28 Fall   rain      9765   61.4    51.0     0.79   10   
## 2 Report… New … 2016-06-07 Summer rain     55269   64.2    54.6     0.79    9.7 
## 3 Report… Nort… 2000-04-21 Spring rain       751   59.0    31.0     0.32   10   
## 4 Report… Mont… 1988-12-15 Winter snow      1757    7.44    0.16    0.75   10   
## 5 Report… New … 2015-10-02 Summer rain     49883   46.7    44.4     0.87    9.16
## # … with 1 more variable: uv_index &lt;dbl&gt;, and abbreviated variable names
## #   ¹​precip_type, ²​temperature, ³​dew_point, ⁴​humidity, ⁵​visibility
```

```r
# drop_na works in a similar manner, but be careful
bigfoot %&gt;% 
  drop_na(precip_type) %&gt;% 
  head(5)
```

```
## # A tibble: 5 × 11
##   title   state date       season preci…¹ number tempe…² dew_p…³ humid…⁴ visib…⁵
##   &lt;chr&gt;   &lt;chr&gt; &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 Report… Okla… 1973-09-28 Fall   rain      9765   61.4    51.0     0.79   10   
## 2 Report… New … 2016-06-07 Summer rain     55269   64.2    54.6     0.79    9.7 
## 3 Report… Nort… 2000-04-21 Spring rain       751   59.0    31.0     0.32   10   
## 4 Report… Mont… 1988-12-15 Winter snow      1757    7.44    0.16    0.75   10   
## 5 Report… New … 2015-10-02 Summer rain     49883   46.7    44.4     0.87    9.16
## # … with 1 more variable: uv_index &lt;dbl&gt;, and abbreviated variable names
## #   ¹​precip_type, ²​temperature, ³​dew_point, ⁴​humidity, ⁵​visibility
```


```r
bigfoot %&gt;% 
  drop_na() %&gt;% 
  head(5) # This would drop any observation that has a single missing value
```
---


```r
# You can also save the results of a pipeline. 
# Here I want to get the top 3 coldest bigfoot sightings
cold_bigfoot &lt;- bigfoot %&gt;% 
  arrange(temperature) %&gt;% 
  head(3)

cold_bigfoot %&gt;% View()
```
---
### the %in% operator

The %in% operator is a useful tool when you have a series of conditions that you want to check. Instead of asking whether cond1 or cond2 or cond3 .... are met, you can use the %in% operator to check them all at once.


```r
states &lt;- c("Virginia", "Washington", "California")
states
```

```
## [1] "Virginia"   "Washington" "California"
```

```r
#This code will look through the bigfoot$state column and will only 
#return the values that match any value in the states vector.
bigfoot %&gt;% 
  filter(state %in% states) %&gt;% 
  head(5)
```

```
## # A tibble: 5 × 11
##   title   state date       season preci…¹ number tempe…² dew_p…³ humid…⁴ visib…⁵
##   &lt;chr&gt;   &lt;chr&gt; &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 "Repor… Virg… 1984-04-08 Spring rain      2285    50.8    28.2    0.48    8.75
## 2 "Repor… Virg… 2003-10-23 Fall   rain     15107    41.0    31.2    0.59   10   
## 3 "Repor… Virg… 2011-06-10 Summer rain     35981    74.1    62.3    0.73    9.24
## 4 "Repor… Virg… 2019-04-10 Spring &lt;NA&gt;     62744    58.0    33.1    0.45   10.0 
## 5 "Repor… Wash… 1950-05-01 Spring rain      1043    40.3    40.3    0.86   10   
## # … with 1 more variable: uv_index &lt;dbl&gt;, and abbreviated variable names
## #   ¹​precip_type, ²​temperature, ³​dew_point, ⁴​humidity, ⁵​visibility
```
---
## select()

Whereas the `filter()` function allows you to return only certain _rows_ matching a condition, the `select()` function returns only certain _columns_. The first argument is the data, and subsequent arguments are the columns you want.


```r
# You can simply list the column names you want to keep 
bigfoot %&gt;% 
  select(title) %&gt;% 
  head(5)
```

```
## # A tibble: 5 × 1
##   title                                             
##   &lt;chr&gt;                                             
## 1 &lt;NA&gt;                                              
## 2 &lt;NA&gt;                                              
## 3 Report 6496: Bicycling student has night encounter
## 4 &lt;NA&gt;                                              
## 5 &lt;NA&gt;
```

```r
# Multiple columns can be separated by a comma
bigfoot %&gt;% 
  select(title, state) %&gt;% 
  head(5)
```

```
## # A tibble: 5 × 2
##   title                                              state       
##   &lt;chr&gt;                                              &lt;chr&gt;       
## 1 &lt;NA&gt;                                               Alabama     
## 2 &lt;NA&gt;                                               Alaska      
## 3 Report 6496: Bicycling student has night encounter Rhode Island
## 4 &lt;NA&gt;                                               Pennsylvania
## 5 &lt;NA&gt;                                               Oregon
```
---

```r
# Or you can use the - sign to tell dplyr the columns you want to drop
bigfoot %&gt;% 
  select(-title, -state) %&gt;% 
  arrange(date) %&gt;% 
  head(5)
```

```
## # A tibble: 5 × 9
##   date       season precip_type number tempera…¹ dew_p…² humid…³ visib…⁴ uv_in…⁵
##   &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 1869-11-10 Fall   &lt;NA&gt;         14338        NA      NA      NA      NA      NA
## 2 1921-01-14 Winter &lt;NA&gt;         14358        NA      NA      NA      NA      NA
## 3 1925-10-14 Fall   &lt;NA&gt;         24413        NA      NA      NA      NA      NA
## 4 1930-09-30 Fall   &lt;NA&gt;          2477        NA      NA      NA      NA      NA
## 5 1937-08-16 Summer &lt;NA&gt;         14336        NA      NA      NA      NA      NA
## # … with abbreviated variable names ¹​temperature, ²​dew_point, ³​humidity,
## #   ⁴​visibility, ⁵​uv_index
```

```r
# You can also use the select function to rename variables
bigfoot %&gt;% 
  select(Bigfoot_Sighting_Report = title, date, state, temperature) %&gt;% 
  head(5)
```

```
## # A tibble: 5 × 4
##   Bigfoot_Sighting_Report                            date       state    tempe…¹
##   &lt;chr&gt;                                              &lt;date&gt;     &lt;chr&gt;      &lt;dbl&gt;
## 1 &lt;NA&gt;                                               NA         Alabama     NA  
## 2 &lt;NA&gt;                                               NA         Alaska      NA  
## 3 Report 6496: Bicycling student has night encounter 1974-09-20 Rhode I…    73.4
## 4 &lt;NA&gt;                                               NA         Pennsyl…    NA  
## 5 &lt;NA&gt;                                               NA         Oregon      NA  
## # … with abbreviated variable name ¹​temperature
```

```r
# There is also a rename() function that does something similar.
```
---
### starts_with(), ends_with(), contains()

The `starts_with`, `ends_with` and `contains` functions provide very useful tools for dropping/keeping several variables at once without having to list each and every column you want to keep. The function will return columns that either start with a specific string of text, ends with a certain string of text, or contain a certain string of text.


```r
bigfoot %&gt;% 
  select(starts_with("s")) %&gt;% 
  head(5)
```

```
## # A tibble: 5 × 2
##   state        season
##   &lt;chr&gt;        &lt;chr&gt; 
## 1 Alabama      Summer
## 2 Alaska       Fall  
## 3 Rhode Island Fall  
## 4 Pennsylvania Summer
## 5 Oregon       Spring
```

```r
bigfoot %&gt;% 
  select(-ends_with("e"), -ends_with("t")) %&gt;% 
  head(5)
```

```
## # A tibble: 5 × 5
##   season number humidity visibility uv_index
##   &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;
## 1 Summer  30680    NA         NA          NA
## 2 Fall     1261    NA         NA          NA
## 3 Fall     6496     0.86       2.75        4
## 4 Summer   8000    NA         NA          NA
## 5 Spring    703    NA         NA          NA
```
---

```r
bigfoot %&gt;% 
  select(contains("um"))
```

```
## # A tibble: 5,021 × 2
##    number humidity
##     &lt;dbl&gt;    &lt;dbl&gt;
##  1  30680    NA   
##  2   1261    NA   
##  3   6496     0.86
##  4   8000    NA   
##  5    703    NA   
##  6   9765     0.79
##  7   4983    NA   
##  8  31940     0.68
##  9   5692     0.45
## 10    438    NA   
## # … with 5,011 more rows
```

```r
# You can also create a vector of column names you want to keep 
bigfoot %&gt;% 
  names()
```

```
##  [1] "title"       "state"       "date"        "season"      "precip_type"
##  [6] "number"      "temperature" "dew_point"   "humidity"    "visibility" 
## [11] "uv_index"
```

```r
vars &lt;- c( "title", "state", "date", "temperature")

bigfoot %&gt;% 
  select(all_of(vars)) %&gt;% 
  head(5)
```

```
## # A tibble: 5 × 4
##   title                                              state    date       tempe…¹
##   &lt;chr&gt;                                              &lt;chr&gt;    &lt;date&gt;       &lt;dbl&gt;
## 1 &lt;NA&gt;                                               Alabama  NA            NA  
## 2 &lt;NA&gt;                                               Alaska   NA            NA  
## 3 Report 6496: Bicycling student has night encounter Rhode I… 1974-09-20    73.4
## 4 &lt;NA&gt;                                               Pennsyl… NA            NA  
## 5 &lt;NA&gt;                                               Oregon   NA            NA  
## # … with abbreviated variable name ¹​temperature
```


```r
bigfoot %&gt;% 
  select(-vars)
```
---
However, you can go ahead and combine `filter` and `select` to subset your data even further.


```r
bigfoot %&gt;% 
  filter(temperature &gt;= 85) %&gt;% 
  select(vars) %&gt;% 
  head(5)
```

```
## # A tibble: 5 × 4
##   title                                                 state date       tempe…¹
##   &lt;chr&gt;                                                 &lt;chr&gt; &lt;date&gt;       &lt;dbl&gt;
## 1 Report 1155: Newspaper account of an encounter with … Nebr… 1980-06-30    85.2
## 2 Report 36830: Multiple witnesses watch figure cross … Ohio  2012-06-28    86  
## 3 Report 26543: Nightime roadside sighting south of Wo… Okla… 2009-08-07    87.7
## 4 Report 65296: Daylight sighting between Broken Bow a… Okla… 2010-08-14    86.6
## 5 Report 17035: Wood knocks heard by hunter outside Ca… Alab… 2007-08-06    87.0
## # … with abbreviated variable name ¹​temperature
```
---
## Exercise 

1. Using the `bigfoot` dataset, how many bigfoot sightings have a uv_index greater than 11.  Answer should be 27. `hint: use filter and nrow()`

2. Use filter to find the bigfoot sightings with a temperature greater than 85 degrees that were during rain (`precip_type`), followed by select to show the state, date, title, and temperature for these observations, arranged in descending order by temperature

3. If I tried to arrange the answer from question 2 by precipitation type instead of temperature, would that work? Why or why not? 


```r
#1. 
bigfoot %&gt;% 
  filter(uv_index &gt; 11) %&gt;% 
  nrow()
```

```
## [1] 27
```
---

```r
#2.
bigfoot %&gt;% 
  filter(temperature &gt; 85 &amp; precip_type == "rain") %&gt;% 
  select(state, date, title, temperature) %&gt;% 
  arrange(-temperature)  %&gt;% 
  head(5)
```

```
## # A tibble: 5 × 4
##   state      date       title                                            tempe…¹
##   &lt;chr&gt;      &lt;date&gt;     &lt;chr&gt;                                              &lt;dbl&gt;
## 1 California 1977-08-01 Report 7555: Two Young Fishermen Have Mid-day E…    89.2
## 2 Georgia    1992-07-11 Report 18707: Two incidents with two witnesses …    87  
## 3 Arkansas   2008-07-26 Report 24276: Possible sighting of an upright c…    85.9
## 4 Kansas     1980-07-20 Report 1311: Daylight sighting by two moto-cros…    85.7
## 5 Florida    2015-07-14 Report 51044: Vacationer has a possible daytime…    85.6
## # … with abbreviated variable name ¹​temperature
```

```r
#3. 
#It Would not work because precipitation type is no longer a part of the dataset at this point
```
---
-------------------------
## summarize()
The `summarize()` function summarizes multiple values to a single value. On its own the `summarize()` function doesn't seem to be all that useful. The dplyr package provides a few convenience functions called `n()` and `n_distinct()` that tell you the number of observations or the number of distinct values of a particular variable.

Notice that summarize takes a data frame and returns a data frame. In this case it's a 1x1 data frame with a single row and a single column. The name of the column, by default is whatever the expression was used to summarize the data. This usually isn't pretty, and if we wanted to work with this resulting data frame later on, we'd want to name that returned value something easier to deal with.


```r
bigfoot %&gt;% 
  summarize(mean(temperature))
```

```
## # A tibble: 1 × 1
##   `mean(temperature)`
##                 &lt;dbl&gt;
## 1                  NA
```

```r
#Gotta watch out for nas. Use na.rm = TRUE to run the calculation without nas being involved.
bigfoot %&gt;% 
  summarize(mean(temperature, na.rm = TRUE))
```

```
## # A tibble: 1 × 1
##   `mean(temperature, na.rm = TRUE)`
##                               &lt;dbl&gt;
## 1                              57.8
```
---

```r
#The default column names do not look very aesthetically pleasing, let's take care of that.
bigfoot %&gt;% 
  summarize(temperature = mean(temperature, na.rm = TRUE))
```

```
## # A tibble: 1 × 1
##   temperature
##         &lt;dbl&gt;
## 1        57.8
```

```r
#Again, summarize alone is not entirely useful
bigfoot %&gt;% 
  summarize(n())
```

```
## # A tibble: 1 × 1
##   `n()`
##   &lt;int&gt;
## 1  5021
```
---
## group_by()

We saw that `summarize()` isn't that useful on its own. Neither is `group_by()` All this does is takes an existing data frame and coverts it into a grouped data frame where operations are performed by group.


```r
bigfoot %&gt;% 
  group_by(state) %&gt;% 
  head(5)
```

```
## # A tibble: 5 × 11
## # Groups:   state [5]
##   title   state date       season preci…¹ number tempe…² dew_p…³ humid…⁴ visib…⁵
##   &lt;chr&gt;   &lt;chr&gt; &lt;date&gt;     &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 &lt;NA&gt;    Alab… NA         Summer &lt;NA&gt;     30680    NA      NA     NA      NA   
## 2 &lt;NA&gt;    Alas… NA         Fall   &lt;NA&gt;      1261    NA      NA     NA      NA   
## 3 Report… Rhod… 1974-09-20 Fall   &lt;NA&gt;      6496    73.4    65.7    0.86    2.75
## 4 &lt;NA&gt;    Penn… NA         Summer &lt;NA&gt;      8000    NA      NA     NA      NA   
## 5 &lt;NA&gt;    Oreg… NA         Spring &lt;NA&gt;       703    NA      NA     NA      NA   
## # … with 1 more variable: uv_index &lt;dbl&gt;, and abbreviated variable names
## #   ¹​precip_type, ²​temperature, ³​dew_point, ⁴​humidity, ⁵​visibility
```

The real power comes in where `group_by()` and `summarize()` are used together. First, write the `group_by()` statement. Then pipe the result to a call to `summarize()`.


```r
#Let's summarize the mean temperature of bigfoot sightings for each state
bigfoot %&gt;% 
  group_by(state) %&gt;% 
  summarize(temperature = mean(temperature, na.rm = TRUE))
```

```
## # A tibble: 49 × 2
##    state       temperature
##    &lt;chr&gt;             &lt;dbl&gt;
##  1 Alabama            65.9
##  2 Alaska             43.1
##  3 Arizona            58.4
##  4 Arkansas           62.2
##  5 California         59.7
##  6 Colorado           48.0
##  7 Connecticut        58.8
##  8 Delaware           54.9
##  9 Florida            71.8
## 10 Georgia            65.5
## # … with 39 more rows
```
---

```r
bigfoot %&gt;% 
  group_by(state) %&gt;% 
  summarize(temperature = mean(temperature, na.rm = TRUE))%&gt;% 
  arrange(-temperature) %&gt;% 
  head(5)
```

```
## # A tibble: 5 × 2
##   state          temperature
##   &lt;chr&gt;                &lt;dbl&gt;
## 1 Florida               71.8
## 2 Louisiana             70.0
## 3 South Carolina        66.4
## 4 Alabama               65.9
## 5 Georgia               65.5
```

```r
# Filter/select are often used in conjunction with summarize
bigfoot %&gt;% 
  filter(precip_type == "snow") %&gt;% 
  drop_na(temperature) %&gt;% 
  group_by(state) %&gt;% 
  summarize(temperature = mean(temperature, na.rm = TRUE)) %&gt;% 
  arrange(-temperature) %&gt;% 
  head(5) 
```

```
## # A tibble: 5 × 2
##   state    temperature
##   &lt;chr&gt;          &lt;dbl&gt;
## 1 Virginia        40.1
## 2 Delaware        38.4
## 3 Idaho           37.3
## 4 Texas           37.2
## 5 Missouri        37.0
```
---

```r
# You can also utilize multiple groups in the group_by statement
bigfoot %&gt;% group_by(state, precip_type) %&gt;% 
  drop_na(precip_type) %&gt;% 
summarize(temperature = mean(temperature, na.rm = TRUE)) %&gt;% 
  arrange(state, precip_type)  %&gt;% 
  print(n = Inf) %&gt;% 
  head(5)
```

```
## # A tibble: 88 × 3
## # Groups:   state [49]
##    state          precip_type temperature
##    &lt;chr&gt;          &lt;chr&gt;             &lt;dbl&gt;
##  1 Alabama        rain              68.6 
##  2 Alabama        snow              25.3 
##  3 Alaska         rain              47.9 
##  4 Alaska         snow              21.3 
##  5 Arizona        rain              59.4 
##  6 Arizona        snow              29.7 
##  7 Arkansas       rain              64.9 
##  8 Arkansas       snow              24.0 
##  9 California     rain              57.5 
## 10 California     snow              34.5 
## 11 Colorado       rain              50.1 
## 12 Colorado       snow              25.3 
## 13 Connecticut    rain              74.8 
## 14 Connecticut    snow              36.6 
## 15 Delaware       rain              42.7 
## 16 Delaware       snow              38.4 
## 17 Florida        rain              74.2 
## 18 Georgia        rain              68.8 
## 19 Georgia        snow              32.9 
## 20 Idaho          rain              49.0 
## 21 Idaho          snow              37.3 
## 22 Illinois       rain              60.9 
## 23 Illinois       snow              27.0 
## 24 Indiana        rain              63.9 
## 25 Indiana        snow              17.7 
## 26 Iowa           rain              59.9 
## 27 Iowa           snow              25.7 
## 28 Kansas         rain              68.1 
## 29 Kansas         snow              25.0 
## 30 Kentucky       rain              61.0 
## 31 Kentucky       snow              30.2 
## 32 Louisiana      rain              68.9 
## 33 Maine          rain              55.2 
## 34 Maine          snow              30.0 
## 35 Maryland       rain              65.1 
## 36 Massachusetts  rain              54.2 
## 37 Michigan       rain              58.6 
## 38 Michigan       snow              25.0 
## 39 Minnesota      rain              59.7 
## 40 Minnesota      snow              21.7 
## 41 Mississippi    rain              65.1 
## 42 Missouri       rain              61.3 
## 43 Missouri       snow              37.0 
## 44 Montana        rain              51.0 
## 45 Montana        snow              13.9 
## 46 Nebraska       rain              66.6 
## 47 Nebraska       snow               8.60
## 48 Nevada         rain             NaN   
## 49 New Hampshire  rain              64.2 
## 50 New Hampshire  snow              14.8 
## 51 New Jersey     rain              56.9 
## 52 New Jersey     snow              30.2 
## 53 New Mexico     rain              57.6 
## 54 New Mexico     snow              27.1 
## 55 New York       rain              59.9 
## 56 New York       snow              23.5 
## 57 North Carolina rain              62.3 
## 58 North Carolina snow              27.8 
## 59 North Dakota   rain              59.0 
## 60 North Dakota   snow              30.7 
## 61 Ohio           rain              60.9 
## 62 Ohio           snow              23.3 
## 63 Oklahoma       rain              61.5 
## 64 Oklahoma       snow              30.5 
## 65 Oregon         rain              51.5 
## 66 Oregon         snow              30.6 
## 67 Pennsylvania   rain              58.0 
## 68 Pennsylvania   snow              26.2 
## 69 Rhode Island   rain              65.8 
## 70 South Carolina rain              61.3 
## 71 South Dakota   rain              51.3 
## 72 South Dakota   snow              22.1 
## 73 Tennessee      rain              62.3 
## 74 Texas          rain              63.2 
## 75 Texas          snow              37.2 
## 76 Utah           rain              51.9 
## 77 Utah           snow              30.9 
## 78 Vermont        rain              57.2 
## 79 Vermont        snow              24.0 
## 80 Virginia       rain              58.3 
## 81 Virginia       snow              40.1 
## 82 Washington     rain              50.3 
## 83 Washington     snow              31.2 
## 84 West Virginia  rain              56.7 
## 85 West Virginia  snow              28.3 
## 86 Wisconsin      rain              60.1 
## 87 Wisconsin      snow              25.0 
## 88 Wyoming        rain              58.8
```

```
## # A tibble: 5 × 3
## # Groups:   state [3]
##   state   precip_type temperature
##   &lt;chr&gt;   &lt;chr&gt;             &lt;dbl&gt;
## 1 Alabama rain               68.6
## 2 Alabama snow               25.3
## 3 Alaska  rain               47.9
## 4 Alaska  snow               21.3
## 5 Arizona rain               59.4
```
---
## MUTATE ##

The `mutate` function allows you to add or modify variables to your dataset. 


```r
# Let us turn our temperature to celsius
names(bigfoot)
```

```
##  [1] "title"       "state"       "date"        "season"      "precip_type"
##  [6] "number"      "temperature" "dew_point"   "humidity"    "visibility" 
## [11] "uv_index"
```

```r
bigfoot %&gt;% 
  mutate(temp_c = (temperature - 32)*5/9) %&gt;% 
  select(starts_with("temp")) %&gt;% 
  head(5)
```

```
## # A tibble: 5 × 2
##   temperature temp_c
##         &lt;dbl&gt;  &lt;dbl&gt;
## 1        NA     NA  
## 2        NA     NA  
## 3        73.4   23.0
## 4        NA     NA  
## 5        NA     NA
```

```r
# This new variable is only temporary, let's save a new object with this column
bigfoot_2 &lt;- bigfoot %&gt;% 
  mutate(temp_c = (temperature - 32)*5/9)

# We can now look at our new dataset with our new variable.
bigfoot_2 %&gt;% 
  group_by(state) %&gt;%
  drop_na(temp_c) %&gt;% 
  summarize(temp_c = mean(temp_c, na.rm = TRUE)) %&gt;% 
  select(state, temp_c) %&gt;% 
  head(5)
```

```
## # A tibble: 5 × 2
##   state      temp_c
##   &lt;chr&gt;       &lt;dbl&gt;
## 1 Alabama     18.8 
## 2 Alaska       6.17
## 3 Arizona     14.7 
## 4 Arkansas    16.8 
## 5 California  15.4
```
---

```r
# mutate with if_else
  #if_else statements allow you to conditionally make changes to your data. 
  #if the condition is true, then the first option will be selected, if not, the 
  #second option will be selected.
bigfoot_2 %&gt;% 
  mutate(summer = ifelse(season == "Summer", 1, 0)) %&gt;% select(summer, season) %&gt;% View()

##case_when
  # the case_when function allows you to complete multiple if_else statements in a single group of commands
bigfoot_2 &lt;- bigfoot_2 %&gt;%
  mutate(temp_cat = case_when(
    temp_c &lt;  0 ~ "Freezing",
    temp_c &gt;= 0 &amp; temp_c &lt; 10 ~ "Cold",
    temp_c &gt;= 10 &amp; temp_c &lt; 20 ~ "Moderate",
    temp_c &gt;= 20 ~ "Warm"
    )
  )

bigfoot_2 %&gt;% 
  count(temp_cat)
```

```
## # A tibble: 5 × 2
##   temp_cat     n
##   &lt;chr&gt;    &lt;int&gt;
## 1 Cold       806
## 2 Freezing   208
## 3 Moderate  1204
## 4 Warm       968
## 5 &lt;NA&gt;      1835
```
---
## Writing out data

Just like you can read in data from read_csv(), you can also write out a csv file. Let's create a new file for our `bigfoot_2` data.


```r
#Include the name of the object to export (bigfoot_2) and the name of the file
write_csv(bigfoot_2, "bigfoot_2.csv")
```
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "3:2",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
